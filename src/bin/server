#!/usr/bin/env php
<?php
declare(strict_types=1);
ini_set('assert.exception', '1');
error_reporting(E_ALL);

if (PHP_SAPI !== 'cli') {
    echo 'bin/server must be run as a CLI application';
    exit(1);
}
try{
    require __DIR__ . '/../../vendor/autoload.php';
}catch(\Exception $exception){
    echo 'Autoload error: ' . $exception->getMessage();
    exit(1);
}
$serviceContainer = new \NHDS\Jobs\Service\Container();
$ymlServiceFilePath = __DIR__ . '/../config/root.yml';
$serviceContainer->addServicesYmlFilePath($ymlServiceFilePath);
foreach ($argv as $argument) {
    if (strstr($argument, 'ysfp:') !== false) {
        $ymlServicesFilePath = explode('ysfp:', $argument);
        $serviceContainer->addServicesYmlFilePath($ymlServicesFilePath[1]);
    }
}
$server = $serviceContainer->getContainerBuilder()->get('nhds.jobs.process.pool.server');
$server->setParentProcessPath('');
$server->start();