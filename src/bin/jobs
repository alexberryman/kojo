#!/usr/bin/env php
<?php
declare(strict_types=1);
ini_set('assert.exception', '1');
error_reporting(E_ALL);

if (PHP_SAPI !== 'cli') {
    echo 'bin/jobs must be run as a CLI application';
    exit(1);
}
try{
    foreach ([
                 __DIR__ . '/../../../../autoload.php',
                 __DIR__ . '/../../vendor/autoload.php',
             ] as $autoLoaderFilePathCandidate) {
        if (file_exists($autoLoaderFilePathCandidate)) {
            require_once $autoLoaderFilePathCandidate;
            break;
        }
    }
}catch(\Exception $exception){
    echo 'Autoload error: ' . $exception->getMessage();
    exit(1);
}
$serviceContainer = new \NHDS\Jobs\Service\Container();
$ymlServiceFilePath = __DIR__ . '/../config/root.yml';
$serviceContainer->addServicesYmlFilePath($ymlServiceFilePath);
if (isset($argv[2]) && is_string($argv[2]) && is_file($argv[2])) {
    $serviceContainer->addServicesYmlFilePath($argv[2]);
}
$consoleApplication = $serviceContainer->getContainerBuilder()->get('nhds.jobs.symfony.component.console.application');

$consoleApplication->run();